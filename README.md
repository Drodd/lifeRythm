# 生活律动 - 生活节奏模拟游戏

这是一个模拟日常生活节奏的音乐游戏应用，让用户通过安排不同的生活行动来创建自己的生活节奏并观察各种统计数据的变化。

## 功能特点

- 右侧为8拍的谱曲区，可编排不同生活行动
- 点击格子激活/停用行动
- 按照140 BPM的速度回放生活节奏
- 三大主要属性：金钱、见闻、欲望
- 二级属性：效率和耐心
- 可解锁多达17种不同的生活行动
- 行动会对不同属性产生影响
- 游戏限制为60天（60次播放）
- 支持移动端触控

## 游戏机制

- 每个行动对应不同的音效，通过Web Audio API合成
- 随着游戏进程解锁新的行动
- 解锁行动需要消耗见闻值
- 每解锁3个行动增加效率值
- 每解锁5个行动增加耐心值
- 效率值影响每个行动产生的属性收益
- 耐心值决定可以同时安排的行动上限

## 如何玩

1. 在谱曲区点击格子安排不同的生活行动
2. 点击右上角的播放按钮开始播放
3. 红线会从左到右移动，触发所经过的行动
4. 每个行动会影响你的三大属性值（金钱、见闻、欲望）
5. 使用合适的见闻值可以解锁新的行动类型
6. 合理安排行动，在60天内尽可能提升你的属性

## 技术栈

- HTML5
- CSS3
- JavaScript (ES6+)
- Web Audio API

## 兼容性

支持现代浏览器：
- Chrome / Edge (最新版)
- Firefox (最新版)
- Safari (最新版)
- 移动端浏览器

## 本地运行

1. 克隆本仓库
2. 在浏览器中打开index.html文件
3. 或者使用本地服务器:
   ```
   npx http-server
   ```
   
## 注意事项

- 在iOS设备上，首次互动后才能播放声音（这是iOS的音频策略限制）
- 建议使用耳机获得最佳音频体验
- 资源消耗较大时可能会导致部分性能较低设备出现卡顿 

## 音频加载问题解决方案

为解决移动设备上音频文件下载限制问题，我们实现了ZIP打包方案。

### 为什么要使用ZIP包加载音频？

在移动设备上，浏览器对同一域名的并发HTTP请求数量有严格限制（通常为6个）。当我们尝试同时下载多个音频文件时，超出这个限制的请求会被延迟或失败。此外，频繁的小文件请求会造成网络资源浪费。

通过将所有音频文件打包成一个ZIP文件，我们可以：

1. 只发送一个HTTP请求获取所有音频文件
2. 减少HTTP请求头的冗余开销
3. 利用ZIP压缩减小总下载大小
4. 避免并发连接限制问题

### 使用方法

#### 1. 准备音频文件

将所有MP3格式的音频文件放入`sounds/`目录中。确保文件名与代码中的音效ID对应：

- `base_rhythm.mp3` - 基础节奏音频
- `snd_work.mp3` - 工作音效
- `snd_eat.mp3` - 吃饭音效
- `snd_read.mp3` - 阅读音效
- 等等...

#### 2. 安装依赖

```bash
npm install jszip fs-extra
```

#### 3. 打包音频文件

```bash
node tools/pack_sounds.js
```

这将在项目根目录生成`sounds.zip`文件。

#### 4. 部署

将生成的`sounds.zip`文件和其他游戏文件一起部署到服务器。

### 注意事项

- 确保服务器配置正确的MIME类型以支持ZIP文件下载
- 如果更新了音频文件，需要重新生成ZIP包
- 如果ZIP文件下载失败，代码会自动回退到生成合成音效

## 技术实现

游戏启动时，会从服务器下载`sounds.zip`文件，解压后直接在浏览器内存中解码所有音频文件，无需额外的HTTP请求。这种方法特别适合移动设备，有效解决了并发请求限制的问题 